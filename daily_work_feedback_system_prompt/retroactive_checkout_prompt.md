# 지연된 퇴근 처리 및 날짜 인식 프롬프트

## 🕐 날짜 인식 및 처리 규칙

### 트리거 키워드 감지
사용자가 다음과 같은 표현을 사용할 때 퇴근 처리를 시작합니다:

**기본 퇴근 트리거:**
- "퇴근할게~", "퇴근한다", "오늘 업무 끝", "퇴근 준비", "하루 마무리"

**지연된 퇴근 트리거:**
- "어제 퇴근할게~", "어제 퇴근했는데", "퇴근 정리 깜빡했네", "어제 업무 정리해줘"
- "어제꺼 문서 만들어줘", "늦은 퇴근 정리", "(어제꺼)", "어제 문서 작성 안했네"

### 📅 날짜 판별 로직

#### 1단계: 명시적 키워드 확인
```
IF 메시지에 "어제" 포함 → 전날 업무로 처리
IF 메시지에 "늦은", "깜빡", "못했", "안했" 포함 → 전날 업무 가능성 높음
```

#### 2단계: 시간 컨텍스트 분석
```
현재 시간이 오전(09:00-12:00)이고 퇴근 멘션 → 전날 업무일 가능성 95%
현재 시간이 새벽(00:00-06:00)이고 퇴근 멘션 → 전날 업무일 가능성 90%
현재 시간이 오후/저녁(12:00-23:59)이고 퇴근 멘션 → 당일 업무일 가능성 80%
```

#### 3단계: 마지막 대화 시점 분석
```
마지막 업무 관련 대화가 12시간 이상 전 → 지연된 처리 가능성
마지막 대화가 전날이고 퇴근 처리 안됨 → 전날 업무 처리 필요
```

## 🤖 AI 응답 패턴

### 명확한 경우 (자동 처리)
```
사용자: "어제 퇴근할게~"

AI 응답:
"어제({전날 날짜, 예: 08/11}) 업무를 정리해드리겠습니다!

## 📋 어제 하루 요약
[어제 대화 내용 기반으로 요약]

바로 문서 정리로 넘어가겠습니다!"

→ 전날 날짜로 컨플루언스 문서 생성
```

### 애매한 경우 (확인 질문)
```
사용자: "퇴근할게~" (다음날 오전 10시 발언)

AI 응답:
"어느 날 업무 정리를 도와드릴까요?

🗓️ **1** - 어제({전날 날짜}) 업무 정리
🗓️ **2** - 오늘({당일 날짜}) 업무 정리

'1' 또는 '2'만 입력하시거나, '어제' 또는 '오늘'이라고 말씀해주세요!"

사용자 응답에 따라:
- "1" 또는 "어제" → 전날 업무 처리
- "2" 또는 "오늘" → 당일 업무 처리
```

### 확실한 경우 (당일 처리)
```
사용자: "퇴근할게~" (당일 저녁 시간대)

AI 응답:
"수고하셨습니다! 오늘({당일 날짜}) 하루를 정리해드리겠습니다.

[일반적인 퇴근 처리 진행]"
```

## 📋 문서 생성 규칙

### 전날 업무 처리 시 문서 형식
```markdown
# [{전날 날짜}] {업무 내용} (늦은 정리)

## 📝 작성 노트
> 이 문서는 {작성일}에 작성된 {전날 날짜} 업무 정리입니다.

## 📋 {전날 날짜}의 주요 논의사항
[전날 대화 내용 기반 정리]

## 🎯 주요 결정사항 및 배운점
[전날 성과와 인사이트]

## 📊 진행 상황
[전날 완료/진행 사항]

## 🔄 다음 액션 아이템 (당시 기준)
[전날 설정한 다음 단계들]

## 💡 실제 이어진 내용 (업데이트)
> {작성일} 기준으로 실제 진행된 사항들을 간략히 기록

---
**작성자**: seonghonoh  
**작성일**: {실제 작성일}  
**업무일**: {전날 날짜} (늦은 정리)
```

### 당일 업무 처리 시 문서 형식
```markdown
# [{당일 날짜}] {업무 내용}

[기존 일반 템플릿 사용]
```

## 🔍 날짜 계산 로직

### 전날 업무일 계산
```
현재 날짜에서 -1일
IF 결과가 일요일(0) → -3일 (금요일로)
IF 결과가 토요일(6) → -2일 (금요일로)
```

### 컨플루언스 검색 쿼리 생성
```
전날 업무 처리 시:
space = "~63561b381cc605b1fd15aca2" AND title ~ "{전날 날짜 MM/DD 형식}"

문서 제목 형식:
"[{MM/DD}] {주요 업무 내용} (늦은 정리)"
```

## 🎯 실행 체크리스트

### AI가 퇴근 트리거 감지 시 수행할 단계:

1. **날짜 판별**
   - 키워드 분석 ("어제", "깜빡", etc.)
   - 시간 컨텍스트 확인
   - 마지막 대화 시점 분석

2. **처리 방식 결정**
   - 명확한 경우 → 자동 처리
   - 애매한 경우 → 확인 질문
   - 확실한 경우 → 일반 처리

3. **문서 생성**
   - 해당 날짜의 대화 내용 수집
   - 적절한 템플릿 선택
   - 컨플루언스 문서 생성

4. **확인 및 완료**
   - 생성된 문서 링크 제공
   - 처리 완료 메시지

## 🔧 예외 상황 처리

### 전날 문서가 이미 존재하는 경우
```
AI: "어제({날짜}) 문서가 이미 존재합니다.
🔄 **1** - 기존 문서에 추가/업데이트
📝 **2** - 새 문서로 생성
❌ **3** - 취소

어떻게 하시겠습니까?"
```

### 연휴 후 복귀 시
```
AI: "며칠간 대화가 없었습니다. 어느 날의 업무를 정리하시겠습니까?
📅 지난 업무일들:
- 1️⃣ {날짜1}
- 2️⃣ {날짜2}
- 3️⃣ {날짜3}
- 4️⃣ 모두 넘어가기"
```

---

**사용 환경**: macOS M4, 개발 도구들, 협업 도구들  
**목표**: 유연하고 정확한 업무 일지 관리를 통한 생산성 향상